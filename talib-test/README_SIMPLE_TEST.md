# راهنمای تست ساده الگوها

این اسکریپت برای تست **یک الگوی خاص** با داده‌های ساختگی است.

---

## 🎯 هدف

پیدا کردن حداقل تعداد کندل مورد نیاز برای تشخیص هر الگو توسط TA-Lib.

---

## 🚀 نحوه استفاده

### مرحله 1: انتخاب الگو

فایل `test_single_pattern_simple.py` را باز کنید و در **خط 25** الگوی مورد نظر را انتخاب کنید:

```python
PATTERN_TO_TEST = "ENGULFING"  # الگوی انتخابی
```

**الگوهای موجود:**
- `ENGULFING` - الگوی Engulfing (2 کندل)
- `HAMMER` - الگوی Hammer (1 کندل)
- `SHOOTINGSTAR` - الگوی Shooting Star (1 کندل)
- `DOJI` - الگوی Doji (1 کندل)
- `MORNINGSTAR` - الگوی Morning Star (3 کندل)

### مرحله 2: اجرای تست

```bash
cd /home/user/New/talib-test
python3 test_single_pattern_simple.py
```

### مرحله 3: بررسی نتایج

اسکریپت:
1. ✅ یک الگوی **کامل و واضح** می‌سازد
2. ✅ با **1 کندل** (فقط خود الگو) شروع می‌کند
3. ✅ تدریجی **کندل‌های قبلی** اضافه می‌کند
4. ✅ می‌بیند با **چند کندل** TA-Lib الگو را تشخیص می‌دهد

---

## 📊 مثال خروجی

```
🔬 شروع تست: Engulfing (صعودی)
==============================================================

📌 تعداد کندل‌های الگو: 2

🧪 تست با تعداد کندل‌های قبلی مختلف:
--------------------------------------------------------------
❌ کندل‌های قبلی:  0 | کل کندل:  2 | تشخیص: NO
❌ کندل‌های قبلی:  1 | کل کندل:  3 | تشخیص: NO
✅ کندل‌های قبلی:  2 | کل کندل:  4 | تشخیص: YES
   ⭐ اولین تشخیص با 2 کندل قبلی!

==============================================================
📊 خلاصه نتایج:
==============================================================

✅ حداقل کندل قبلی لازم: 2
✅ حداقل کل کندل لازم: 4

💡 نتیجه: این الگو به 2 کندل قبلی + 2 کندل الگو نیاز دارد
   یعنی TA-Lib از کندل‌های قبلی برای context استفاده می‌کند
```

---

## 🔬 روش کار اسکریپت

### 1. ساخت الگوی واضح

برای هر الگو، یک نمونه **کاملاً واضح** ساخته می‌شود:

**مثال: Engulfing**
```
کندل 0: نزولی (open=105 > close=100)
کندل 1: صعودی (open=98 < close=108)
→ کندل 2 کندل 1 را کاملاً می‌بلعد ✅
```

**مثال: Hammer**
```
Body size: 1
Lower shadow: 6 (= 6.0× body)
Upper shadow: 1
→ سایه پایین بلند، بدنه کوچک ✅
```

### 2. تست تدریجی

اسکریپت با تعداد مختلف کندل تست می‌کند:
- 0 کندل قبلی (فقط خود الگو)
- 1 کندل قبلی
- 2 کندل قبلی
- 3 کندل قبلی
- ...
- 30 کندل قبلی

### 3. پیدا کردن Minimum

وقتی برای اولین بار الگو تشخیص داده شد:
```
✅ حداقل کندل قبلی لازم: N
```

---

## 🎓 تفسیر نتایج

### حالت 1: الگو با 0 کندل قبلی کار کرد

```
✅ حداقل کندل قبلی لازم: 0
💡 این الگو با فقط 1 کندل (خود الگو) کار می‌کند!
```

**معنی:** TA-Lib برای این الگو به context نیاز ندارد.

### حالت 2: الگو به N کندل قبلی نیاز دارد

```
✅ حداقل کندل قبلی لازم: 11
✅ حداقل کل کندل لازم: 12
💡 این الگو به 11 کندل قبلی + 1 کندل الگو نیاز دارد
```

**معنی:** TA-Lib از کندل‌های قبلی برای context استفاده می‌کند.

### حالت 3: الگو اصلاً تشخیص نشد

```
❌ الگو در هیچ حالتی تشخیص داده نشد!
   ممکن است:
   - الگوی ساخته شده اشتباه باشد
   - به کندل‌های بیشتری نیاز باشد
   - TA-Lib معیارهای دقیق‌تری دارد
```

**معنی:** ممکن است الگوی ساخته شده به اندازه کافی دقیق نباشد.

---

## 🔧 اضافه کردن الگوی جدید

اگر می‌خواهید الگوی جدیدی اضافه کنید:

### 1. اضافه کردن به PATTERN_INFO

```python
PATTERN_INFO = {
    # ...
    "YOUR_PATTERN": {
        "name": "نام فارسی الگو",
        "talib_func": talib.CDLYOURPATTERN,
        "description": "توضیح مختصر"
    },
}
```

### 2. ساخت تابع سازنده داده

```python
def create_your_pattern():
    """
    ساخت یک الگوی YOUR_PATTERN واضح
    """
    data = {
        'open':   [...],
        'high':   [...],
        'low':    [...],
        'close':  [...],
    }
    df = pd.DataFrame(data)

    print("\n📊 الگوی ساخته شده: YOUR_PATTERN")
    print("="*60)
    print(df)
    print("\nتوضیح:")
    print("  ...")

    return df
```

### 3. اضافه کردن به main()

```python
elif PATTERN_TO_TEST == "YOUR_PATTERN":
    pattern_df = create_your_pattern()
```

---

## 📝 نکات مهم

### ✅ این اسکریپت خوب است برای:
- تست **یک الگو** با دقت
- فهمیدن **دقیق** تعداد کندل مورد نیاز
- بررسی الگوهایی که **خودتان** می‌سازید

### ⚠️ این اسکریپت برای چه کاری نیست:
- تست **چندین الگو** همزمان (برای این از `test_all_patterns_lookback.py` استفاده کنید)
- تست با **داده واقعی** (این اسکریپت فقط با داده ساختگی کار می‌کند)

---

## 🎯 مراحل پیشنهادی

1. **تست Engulfing** (ساده‌ترین - 2 کندل)
   ```python
   PATTERN_TO_TEST = "ENGULFING"
   ```

2. **تست Hammer** (1 کندل)
   ```python
   PATTERN_TO_TEST = "HAMMER"
   ```

3. **تست Morning Star** (3 کندل)
   ```python
   PATTERN_TO_TEST = "MORNINGSTAR"
   ```

4. بررسی نتایج و **مقایسه** با یافته‌های قبلی

---

## 🐛 اگر مشکلی پیش آمد

### خطا: Module not found 'talib'

```bash
pip3 install TA-Lib pandas numpy
```

### الگو تشخیص نشد

احتمالات:
1. الگوی ساخته شده به اندازه کافی **واضح** نیست
2. TA-Lib معیارهای **دقیق‌تری** دارد
3. به کندل‌های **بیشتری** نیاز است (تعداد را در لیست افزایش دهید)

برای دیباگ:
```python
# در تابع test_pattern... خط result را print کنید:
print(f"Result array: {result}")
```

---

## ✅ بعد از تست چه کار کنیم؟

وقتی نتایج را دیدید:

1. **ثبت نتایج** در یک فایل `.txt` یا `.md`
2. **مقایسه** با نتایج `test_all_patterns_lookback.py`
3. اگر نتایج مطابقت داشت → **اصلاح کد تشخیص الگو**
4. اگر نتایج متفاوت بود → **بررسی بیشتر**

---

**نوشته شده توسط:** Test Team
**تاریخ:** 2025-10-25
**نسخه:** 1.0.0
